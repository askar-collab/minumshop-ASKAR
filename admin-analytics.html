<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Admin Analytics | MINUMSHOP</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:Poppins;
  background:linear-gradient(120deg,#fff7ed,#ffedd5,#fed7aa);
  color:#1f2937
}

/* HEADER */
header{
  background:linear-gradient(135deg,#fb923c,#f97316);
  color:white;
  padding:22px;
  text-align:center;
  position:sticky;
  top:0;
  z-index:10
}
header span{
  background:#7c2d12;
  padding:6px 14px;
  border-radius:999px;
  font-size:13px;
  font-weight:700;
  margin-left:10px;
  animation:pulse 1.4s infinite
}
@keyframes pulse{
  0%,100%{transform:scale(1)}
  50%{transform:scale(1.1)}
}

/* NAV */
.nav{
  display:flex;
  justify-content:space-between;
  padding:10px 20px;
  flex-wrap:wrap;
  gap:10px
}
.nav button{
  background:white;
  color:#fb923c;
  border:none;
  padding:8px 18px;
  border-radius:999px;
  font-weight:700;
  cursor:pointer;
  box-shadow:0 6px 16px rgba(0,0,0,.2);
  transition:.3s
}
.nav button:hover{transform:translateY(-3px)}

/* CONTAINER */
.container{
  max-width:1200px;
  margin:30px auto;
  padding:0 20px
}

/* STATS */
.stats{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:20px
}
.stat{
  background:white;
  padding:22px;
  border-radius:20px;
  text-align:center;
  box-shadow:0 18px 40px rgba(0,0,0,.12)
}
.stat h2{margin:10px 0;color:#1e40af}

/* CHART */
.chart{
  background:white;
  padding:25px;
  margin-top:40px;
  border-radius:20px;
  box-shadow:0 18px 40px rgba(0,0,0,.12)
}
.bar{
  height:30px;
  background:linear-gradient(135deg,#22c55e,#16a34a);
  border-radius:10px;
  margin-bottom:12px;
  color:white;
  font-weight:700;
  padding-left:12px;
  display:flex;
  align-items:center;
  animation:grow .8s ease
}
@keyframes grow{from{width:0}}

/* TABLE */
table{
  width:100%;
  border-collapse:collapse;
  margin-top:30px;
  background:white;
  border-radius:16px;
  overflow:hidden;
  box-shadow:0 18px 40px rgba(0,0,0,.12)
}
th,td{
  padding:14px;
  border-bottom:1px solid #e5e7eb;
  text-align:left
}
th{
  background:#fb923c;
  color:white
}

/* FOOTER */
footer{
  text-align:center;
  padding:30px;
  color:#475569;
  font-size:14px
}
</style>
</head>

<body>

<script>
/* AUTH */
if(localStorage.getItem("role")!=="admin"){
  alert("ADMIN ONLY");
  location.href="index.html";
}
</script>

<header>
  <h1>üöÄ Admin Analytics Dashboard
    <span>ADMIN ONLY</span>
  </h1>
</header>

<div class="nav">
  <button onclick="location.href='index.html'">üè† Beranda</button>
  <button onclick="exportExcel()">üì• Export Excel</button>
  <button onclick="resetStok()">‚ôª Reset Stok</button>
  <button onclick="logout()">üö™ Logout</button>
</div>

<div class="container">

  <!-- SUMMARY -->
  <div class="stats">
    <div class="stat">
      <h3>Total Produk</h3>
      <h2 id="totalProduk">0</h2>
    </div>
    <div class="stat">
      <h3>Total Transaksi</h3>
      <h2 id="totalOrder">0</h2>
    </div>
    <div class="stat">
      <h3>Total Pendapatan</h3>
      <h2 id="totalUang">Rp 0</h2>
    </div>
  </div>

  <!-- CHART BULANAN -->
  <div class="chart">
    <h3>üìä Chart Penjualan Bulanan</h3>
    <div id="chart"></div>
  </div>

  <!-- LAPORAN USER -->
  <h3 style="margin-top:50px">üë§ Laporan Per User</h3>
  <table>
    <thead>
      <tr>
        <th>User</th>
        <th>Total Item</th>
        <th>Total Belanja</th>
      </tr>
    </thead>
    <tbody id="userReport"></tbody>
  </table>

</div>

<footer>
  Created by ASKAR<br>
  Hanya Untuk Demo E-Commerce Informatika
</footer>

<script>
const products = JSON.parse(localStorage.getItem("products"))||[];
const invoices = JSON.parse(localStorage.getItem("invoiceHistory"))||[];

/* SUMMARY */
document.getElementById("totalProduk").innerText = products.length;
document.getElementById("totalOrder").innerText = invoices.length;

let omzet=0;
invoices.forEach(i=>{
  i.cart.forEach(p=>{
    omzet+=p.harga*p.qty;
  });
});
document.getElementById("totalUang").innerText="Rp "+omzet;

/* CHART BULANAN */
const chart=document.getElementById("chart");
const bulan={};

invoices.forEach(i=>{
  const m=i.tanggal.split("/")[1]||"Unknown";
  let total=0;
  i.cart.forEach(p=>total+=p.harga*p.qty);
  bulan[m]=(bulan[m]||0)+total;
});

Object.keys(bulan).forEach(b=>{
  chart.innerHTML+=`
  <div class="bar" style="width:${Math.min(bulan[b]/1000,100)}%">
    Bulan ${b} : Rp ${bulan[b]}
  </div>`;
});

/* USER REPORT */
const userData={};
invoices.forEach(i=>{
  if(!userData[i.user]) userData[i.user]={qty:0,total:0};
  i.cart.forEach(p=>{
    userData[i.user].qty+=p.qty;
    userData[i.user].total+=p.harga*p.qty;
  });
});

const ur=document.getElementById("userReport");
Object.keys(userData).forEach(u=>{
  ur.innerHTML+=`
  <tr>
    <td>${u}</td>
    <td>${userData[u].qty}</td>
    <td>Rp ${userData[u].total}</td>
  </tr>`;
});

/* EXPORT EXCEL */
function exportExcel(){
  let csv="User,Produk,Qty,Harga\n";
  invoices.forEach(i=>{
    i.cart.forEach(p=>{
      csv+=`${i.user},${p.nama},${p.qty},${p.harga}\n`;
    });
  });
  const blob=new Blob([csv],{type:"text/csv"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="laporan-minumshop.csv";
  a.click();
}

/* RESET STOK */
function resetStok(){
  if(!confirm("Reset stok semua produk?"))return;
  products.forEach(p=>p.stok=10);
  localStorage.setItem("products",JSON.stringify(products));
  alert("Stok berhasil direset");
}

/* LOGOUT */
function logout(){
  if(confirm("Logout admin?")){
    localStorage.clear();
    location.href="login.html";
  }
}
</script>

</body>
</html>
