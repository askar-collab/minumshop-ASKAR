<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Admin Users | MINUMSHOP</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&display=swap" rel="stylesheet">

<style>
body{margin:0;font-family:Poppins;background:#fef3c7;padding-bottom:100px}
header{background:#92400e;color:white;padding:20px;text-align:center}
.container{max-width:950px;margin:20px auto;padding:0 15px}

.card{
  background:white;
  padding:16px;
  border-radius:16px;
  margin-bottom:14px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  box-shadow:0 10px 25px rgba(0,0,0,.1);
}
.info{display:flex;flex-direction:column}
.badge{
  display:inline-block;
  padding:4px 10px;
  border-radius:999px;
  font-size:12px;
  font-weight:700;
  margin-top:6px;
  width:fit-content
}
.admin{background:#2563eb;color:white}
.buyer{background:#22c55e;color:white}
.block{background:#ef4444;color:white}
.active{background:#f97316;color:white}

.actions button{
  padding:6px 12px;
  border:none;
  border-radius:8px;
  font-weight:600;
  cursor:pointer;
  margin-left:6px
}
.del{background:#ef4444;color:white}
.ban{background:#64748b;color:white}
.unban{background:#22c55e;color:white}

.stat{
  font-size:13px;
  color:#334155;
  margin-top:4px
}

/* FLOAT NAV */
.fab-nav{
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  gap:15px
}
.fab-nav button{
  padding:14px 22px;
  border-radius:999px;
  border:none;
  color:white;
  font-size:15px;
  cursor:pointer
}
.back{background:#64748b}
.home{background:#22c55e}
.next{background:#f97316}
</style>
</head>

<body>

<script>
/* AUTH */
if(localStorage.getItem("role")!=="admin"){
  alert("Akses ditolak");
  location.href="index.html";
}

/* DATA */
let buyers = JSON.parse(localStorage.getItem("buyers")) || [];
let invoices = JSON.parse(localStorage.getItem("invoices")) || [];
let banned = JSON.parse(localStorage.getItem("bannedBuyers")) || [];
const currentUser = localStorage.getItem("currentUser");

/* HITUNG TRANSAKSI */
function stats(username){
  const userInv = invoices.filter(i=>i.user===username);
  const total = userInv.reduce((a,b)=>a+(b.grand||0),0);
  return {
    count:userInv.length,
    total
  };
}

/* RENDER */
function render(){
  const list=document.getElementById("list");
  list.innerHTML="";

  /* ADMIN */
  list.innerHTML+=`
  <div class="card">
    <div class="info">
      <b>admin</b>
      <span class="badge admin">ADMIN</span>
    </div>
    <span class="badge active">AKTIF</span>
  </div>`;

  /* BUYER SORT (PALING SERING BELANJA) */
  buyers
  .map(b=>{
    const s=stats(b.username);
    return {...b,...s};
  })
  .sort((a,b)=>b.count-a.count)
  .forEach((b,i)=>{
    const isBan=banned.includes(b.username);
    list.innerHTML+=`
    <div class="card">
      <div class="info">
        <b>${i===0?"üèÜ ":""}${b.username}</b>
        <span class="badge buyer">BUYER</span>
        <div class="stat">
          üì¶ ${b.count} transaksi <br>
          üí∞ Rp ${b.total}
        </div>
      </div>

      <div class="actions">
        ${isBan?'<span class="badge block">BLOKIR</span>':''}
        <button class="${isBan?'unban':'ban'}"
          onclick="toggleBan('${b.username}')">
          ${isBan?'Buka':'Blokir'}
        </button>
        <button class="del" onclick="hapus('${b.username}')">Hapus</button>
      </div>
    </div>`;
  });
}

/* HAPUS BUYER */
function hapus(user){
  if(!confirm("Hapus buyer "+user+" ?"))return;
  buyers=buyers.filter(b=>b.username!==user);
  invoices=invoices.filter(i=>i.user!==user);
  banned=banned.filter(b=>b!==user);
  save();
}

/* BLOKIR */
function toggleBan(user){
  if(banned.includes(user)){
    banned=banned.filter(b=>b!==user);
  }else{
    banned.push(user);
  }
  save();
}

/* SAVE */
function save(){
  localStorage.setItem("buyers",JSON.stringify(buyers));
  localStorage.setItem("invoices",JSON.stringify(invoices));
  localStorage.setItem("bannedBuyers",JSON.stringify(banned));
  render();
}

render();
</script>

<header>
  <h1>üë• Manajemen Buyer</h1>
</header>

<div class="container">
  <div id="list"></div>
</div>

<div class="fab-nav">
  <button class="back" onclick="history.back()">‚¨Ö</button>
  <button class="home" onclick="location.href='index.html'">üè†</button>
  <button class="next" onclick="location.href='product-admin.html'">üì¶</button>
</div>

</body>
</html>
